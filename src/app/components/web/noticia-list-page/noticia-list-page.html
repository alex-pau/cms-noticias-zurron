@if (loaded) {
  <div class="container-fluid">

    <div class="row">
      <div class="col-12 d-flex mt-3">
        <div class="input-group mb-4 ms-3">
          <span class="input-group-text bg-transparent border-end-0">
            <i class="bi bi-search"></i>
          </span>
          <input type="search" class="form-control border-start-0 shadow-none"
                 placeholder="BUSCAR EN LA HEMEROTECA..."
                 (input)="search($event)">
        </div>
      </div>
    </div>

    @if (noticiaList().length === 0) {
      <div class="text-center py-5">
        <h2 class="text-muted fw-light">No hay noticias disponibles.</h2>
        <button class="btn btn-outline-dark mt-3" routerLink="/noticias/add">Redactar Nueva</button>
      </div>
    } @else {

      <div class="mb-4 ms-3">
        <button class="btn btn-dark btn-sm px-4 rounded-0" routerLink="/noticias/add">
          + REDACTAR NOTICIA
        </button>
      </div>

      <div class="row g-5">
        @for (noticia of noticiaList(); track noticia._id) {
          <div class="col-md-6 col-lg-4">

            <div class="noticia-wrapper h-100 p-2">

              <div class="noticia-overlay rounded-0">
                <button [routerLink]="['/noticias/edit', noticia._id]"
                        class="btn shadow-lg d-flex align-items-center justify-content-center"
                        style="background-color: #6f42c1; color: white; width: 50px; height: 50px; border-radius: 50%; border: none;">
                  <i class="bi bi-pencil-fill fs-5"></i>
                </button>

                <button class="btn btn-danger shadow-lg d-flex align-items-center justify-content-center"
                        style="width: 50px; height: 50px; border-radius: 50%;"
                        data-bs-toggle="modal"
                        [attr.data-bs-target]="'#deleteModal'+noticia._id">
                  <i class="bi bi-trash3-fill fs-5"></i>
                </button>
              </div>

              <div class="d-flex flex-column h-100">

                <div class="mb-3 position-relative">
                  <span class="position-absolute top-0 start-0 bg-dark text-white px-3 py-1 small fw-bold rounded-0 text-uppercase">
                    {{ noticia.seccion.nombre }}
                  </span>
                  <img [src]="noticia.imagenes?.[0] || 'assets/images/fotoDefecto.png'"
                       [alt]="noticia.titulo"
                       class="img-fluid w-100"
                       style="height: 240px; object-fit: cover;"
                       onerror="this.src='assets/images/fotoDefecto.png'">
                </div>

                <h3 class="h4 fw-bold mb-2 lh-sm text-dark">{{ noticia.titulo }}</h3>
                <p class="text-secondary mb-2 small">
                  {{ noticia.subtitulo || (noticia.contenido | slice:0:100) }}...
                </p>

                <div class="mt-auto border-top pt-2">
                  <small class="text-muted text-uppercase" style="font-size: 0.7rem; letter-spacing: 1px;">
                    {{ noticia.autor }} <span class="mx-1">/</span> {{ noticia.fecha | date:'dd.MM.yyyy' }}
                  </small>
                </div>
              </div>
            </div>

            <div class="modal fade" [attr.id]="'deleteModal'+noticia._id" tabindex="-1">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content rounded-0">
                  <div class="modal-header bg-dark text-white rounded-0 border-0">
                    <h5 class="modal-title">Confirmar eliminación</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body py-4 text-center">
                    <p class="mb-0 text-muted">¿Estás seguro de eliminar esta noticia?</p>
                    <p class="fw-bold mt-2 fs-5">"{{ noticia.titulo }}"</p>
                  </div>
                  <div class="modal-footer border-0 justify-content-center">
                    <button class="btn btn-light border rounded-0 px-4" data-bs-dismiss="modal">CANCELAR</button>
                    <button class="btn btn-danger rounded-0 px-4" data-bs-dismiss="modal" (click)="deleteNoticia(noticia._id!)">BORRAR</button>
                  </div>
                </div>
              </div>
            </div>

          </div>
        }
      </div>
    }
  </div>
} @else {
  <app-loading-spinner />
}
